# 하이퍼레저 패브릭 시작하기
## 사전작업
```
cd $GOPATH/src/fabric-samples/
```
```
cp -r ./first-network ./first-network-copy
```
```
cd $GOPATH/src/fabric-samples/first-network
```
```
./byfn.sh generate
```
## 진행 작업
1. cryptogen 도구를 사용해 인증서를 생성
2. configtxgen 도구를 사용해 오더링 서비스 노드의 제네시스 블록을 생성
3. configtxgen 도구를 사용해 채널을 생성
4. configtxgen 도구를 사용해 Org1MSP에 대한 앵커 피어 노드 트랜잭션 파일 생성
5. configtxgen 도구를 사용해 Org2MSP에 대한 앵커 피어 노드 트랜잭션 파일 생성

## 1. cryptogen 도구를 사용해 인증서를 생성
```
cd $GOPATH/src/fabric-samples/first-network-copy
```
```
code crypto-config.yaml
```
### cryto-config.yaml 파일 구성요소
```
OrdererOrgs: # 정렬 노드의 조직적 정의
  - Name: Orderer # orderer 노드 이름
    Domain: example.com # orderer 노드 루트 
    Specs:
      - Hostname: orderer # 호스트 이름
PeerOrgs: # 피어 노드 조직 정의
  - Name: Org1 # 조직1 이름
    Domain: org1.example.com # 조직1의 도메인
    Template:
      Count: 2 # 조직의 노드 수
    Users:
      Count: 1 # 조직의 사용자 수
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2
    Users:
      Count: 1
```
### 생성된 인증서 파일 확인 
```
../bin/cryptogen generate --config=./crypto-config.yaml
```
```
ls crypto-config
```
## 2. configtxgen 도구를 사용해 오더링 서비스 노드의 제네시스 블록을 생성
### configtx.yaml 파일 구성요소
```
Profiles:

    TwoOrgsOrdererGenesis:
        <<: *ChannelDefaults
        Orderer:
            <<: *OrdererDefaults
            Organizations:
                - *OrdererOrg
            Capabilities:
                <<: *OrdererCapabilities
        Consortiums:
            SampleConsortium:
                Organizations:
                    - *Org1
                    - *Org2
```
### 제네시스 블록 생성
```
export FABRIC_CFG_PATH=$PWD
```
```
../bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block
```
## 3. configtxgen 도구를 사용해 채널을 생성
### configtx.yaml 파일 구성요소
```
Profiles:

    TwoOrgsChannel:
        Consortium: SampleConsortium
        <<: *ChannelDefaults
        Application:
            <<: *ApplicationDefaults
            Organizations:
                - *Org1
                - *Org2
            Capabilities:
                <<: *ApplicationCapabilities
```
### 채널 트랜잭션 생성
```
export CHANNEL_NAME=mychannel
```
```
../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
```
## 4. configtxgen 도구를 사용해 Org1MSP에 대한 앵커 피어 노드 트랜잭션 파일 생성
```
../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
```
## 5. configtxgen 도구를 사용해 Org2MSP에 대한 앵커 피어 노드 트랜잭션 파일 생성
```
../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
```
### BYFN 네트워크 실행
```
cd $GOPATH/src/fabric-samples/first-network
```
```
./byfn.sh up
```
### BYFN 네트워크 관련 도커 컨테이너 확인
```
docker ps
```